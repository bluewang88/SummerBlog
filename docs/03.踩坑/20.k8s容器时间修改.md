---
title: k8s容器时间修改
date: 2020-10-12 17:49:42
permalink: /pages/ff8794/
categories:
  - 踩坑
tags:
  - K8s
---

如何处理 K8S 启动的POD，默认时区不准的问题。

<!-- more -->


## 示例

- 这里进入pod查看时间是不对的

```shell
[root@master bin]# kubectl get pod
NAME                            READY   STATUS    RESTARTS   AGE
elasticsearch-b4489c797-cc28f   1/1     Running   0          152m
eureka-0                        1/1     Running   0          4d2h
mysql-ddd86f8fb-7shp9           1/1     Running   0          8h
nginx-0                         1/1     Running   0          4d1h
redis-0                         1/1     Running   0          8d
zuul-0                          1/1     Running   0          4s
[root@elasticsearch-b4489c797-cc28f elasticsearch]# date
Tue Jan 12 09:58:27 UTC 2021
[root@elasticsearch-b4489c797-cc28f elasticsearch]# exit
exit
```

## 使用 podpreset

- k8s默认没有开启这个功能
  
```shell
[root@master bin]# kubectl get podpreset
error: the server doesn't have a resource type "podpreset"
```


- 开启 podpreset 功能

> 添加一行配置- --runtime-config=settings.k8s.io/v1alpha1=true，enable-admission-plugins后面增加PodPreset。

```shell
[root@master bin]# vim /etc/kubernetes/manifests/kube-apiserver.yaml
[root@master bin]# kubectl get podpreset
No resources found in default namespace.
```

## 创建PodPreset

::: encrypt encrypted key=key owners=summer
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
:::

## 删除pod验证


```shell
[root@master bin]# kubectl delete pod elasticsearch-b4489c797-cc28f
pod "elasticsearch-b4489c797-cc28f" deleted
[root@master bin]# kubectl get pod
NAME                            READY   STATUS    RESTARTS   AGE
elasticsearch-b4489c797-f2pw7   1/1     Running   0          8s
eureka-0                        1/1     Running   0          4d2h
mysql-ddd86f8fb-7shp9           1/1     Running   0          8h
nginx-0                         1/1     Running   0          4d1h
redis-0                         1/1     Running   0          8d
zuul-0                          1/1     Running   0          10m
[root@master bin]# kubectl exec -it elasticsearch-b4489c797-f2pw7 /bin/bash
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.
[root@elasticsearch-b4489c797-f2pw7 elasticsearch]# date
Tue Jan 12 17:59:08 CST 2021
```
